<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Games Verse</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <style>
        .admin-container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        .admin-tab { padding: 10px 20px; background: var(--bg-secondary); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .admin-tab.active { background: var(--accent-gradient); color: white; }
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary); }
        .form-control { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-family: inherit; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
        .btn-primary { background: var(--accent-gradient); color: white; }
        .btn-danger { background: #ff4444; color: white; }
        .items-list { display: grid; gap: 15px; margin-top: 20px; }
        .item-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .item-actions { display: flex; gap: 10px; }
        .game-preview { display: flex; align-items: center; gap: 15px; }
        .game-preview img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="header-titles">
                    <h1 class="app-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                    <span class="app-subtitle">Games Verse - Firebase</span>
                </div>
                <button class="guide-button" onclick="window.location.href='index.html'">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
                </button>
            </div>
        </header>

        <main class="main-content">
            <div class="admin-container">
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
                    <button class="admin-tab" data-tab="news">üì∞ –ù–æ–≤–æ—Å—Ç–∏</button>
                </div>

                <!-- Games Section -->
                <div id="games-section" class="admin-section active">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏</h2>
                    <form id="game-form">
                        <input type="hidden" id="game-id">
                        <div class="form-group">
                            <label for="game-name">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã</label>
                            <input type="text" id="game-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="game-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea id="game-description" class="form-control" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="game-image">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                            <input type="url" id="game-image" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="game-url">–°—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞</label>
                            <input type="url" id="game-url" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="game-players">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</label>
                            <input type="text" id="game-players" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="game-beta"> –ë–µ—Ç–∞-–≤–µ—Ä—Å–∏—è</label>
                        </div>
                        <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Firebase</button>
                    </form>

                    <div class="items-list" id="games-list"></div>
                </div>

                <!-- News Section -->
                <div id="news-section" class="admin-section">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</h2>
                    <form id="news-form">
                        <input type="hidden" id="news-id">
                        <div class="form-group">
                            <label for="news-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type="text" id="news-title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="news-content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                            <textarea id="news-content" class="form-control" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="news-image">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                            <input type="url" id="news-image" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="news-date">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                            <input type="datetime-local" id="news-date" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Firebase</button>
                    </form>

                    <div class="items-list" id="news-list"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Firebase –∫–æ–Ω—Ñ–∏–≥
        const firebaseConfig = {
            apiKey: "AIzaSyC7ET2n5MJ6V_jFMjNWaDycd4LRyfkZnMw",
            authDomain: "hamsterversehost.firebaseapp.com",
            projectId: "hamsterversehost",
            storageBucket: "hamsterversehost.firebasestorage.app",
            messagingSenderId: "895206280147",
            appId: "1:895206280147:web:64e4929ee7e1599ca47d26"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
        if (localStorage.getItem('is_admin') !== 'true') {
            alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
            window.location.href = 'index.html';
        }

        // –¢–∞–±—ã
        document.querySelectorAll('.admin-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(`${targetTab}-section`).classList.add('active');
            });
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        loadGames();
        loadNews();

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏
        document.getElementById('game-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await saveGame();
        });

        async function loadGames() {
            try {
                const snapshot = await db.collection('games').get();
                const games = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                displayGamesList(games);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä:', error);
                document.getElementById('games-list').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        }

        async function saveGame() {
            const gameData = {
                name: document.getElementById('game-name').value,
                description: document.getElementById('game-description').value,
                image: document.getElementById('game-image').value,
                url: document.getElementById('game-url').value,
                players: document.getElementById('game-players').value,
                beta: document.getElementById('game-beta').checked
            };

            const gameId = document.getElementById('game-id').value;

            try {
                if (gameId) {
                    await db.collection('games').doc(gameId).set(gameData);
                } else {
                    await db.collection('games').add(gameData);
                }
                alert('‚úÖ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ Firebase!');
                resetGameForm();
                loadGames();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        function displayGamesList(games) {
            const container = document.getElementById('games-list');
            container.innerHTML = games.map(game => `
                <div class="item-card">
                    <div class="game-preview">
                        <img src="${game.image}" alt="${game.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzY2N2VlYSIvPgo8L3N2Zz4K'">
                        <div>
                            <strong>${game.name}</strong>
                            <div style="font-size: 12px; color: var(--text-secondary);">${game.players} –∏–≥—Ä–æ–∫–æ–≤</div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn" onclick="editGame('${game.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteGame('${game.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function editGame(id) {
            try {
                const doc = await db.collection('games').doc(id).get();
                if (doc.exists) {
                    const game = doc.data();
                    document.getElementById('game-id').value = id;
                    document.getElementById('game-name').value = game.name;
                    document.getElementById('game-description').value = game.description;
                    document.getElementById('game-image').value = game.image;
                    document.getElementById('game-url').value = game.url;
                    document.getElementById('game-players').value = game.players;
                    document.getElementById('game-beta').checked = game.beta || false;
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã: ' + error.message);
            }
        }

        async function deleteGame(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∏–≥—Ä—É?')) {
                try {
                    await db.collection('games').doc(id).delete();
                    alert('‚úÖ –ò–≥—Ä–∞ —É–¥–∞–ª–µ–Ω–∞!');
                    loadGames();
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
                }
            }
        }

        function resetGameForm() {
            document.getElementById('game-form').reset();
            document.getElementById('game-id').value = '';
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏
        document.getElementById('news-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await saveNews();
        });

        async function loadNews() {
            try {
                const snapshot = await db.collection('news').orderBy('date', 'desc').get();
                const news = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                displayNewsList(news);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π:', error);
            }
        }

        async function saveNews() {
            const newsData = {
                title: document.getElementById('news-title').value,
                content: document.getElementById('news-content').value,
                image: document.getElementById('news-image').value,
                date: document.getElementById('news-date').value
            };

            const newsId = document.getElementById('news-id').value;

            try {
                if (newsId) {
                    await db.collection('news').doc(newsId).set(newsData);
                } else {
                    await db.collection('news').add(newsData);
                }
                alert('‚úÖ –ù–æ–≤–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ Firebase!');
                resetNewsForm();
                loadNews();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        function displayNewsList(news) {
            const container = document.getElementById('news-list');
            container.innerHTML = news.map(item => `
                <div class="item-card">
                    <div>
                        <strong>${item.title}</strong>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${new Date(item.date).toLocaleDateString('ru-RU')}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn" onclick="editNews('${item.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteNews('${item.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function editNews(id) {
            try {
                const doc = await db.collection('news').doc(id).get();
                if (doc.exists) {
                    const news = doc.data();
                    document.getElementById('news-id').value = id;
                    document.getElementById('news-title').value = news.title;
                    document.getElementById('news-content').value = news.content;
                    document.getElementById('news-image').value = news.image || '';
                    document.getElementById('news-date').value = news.date;
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–∏: ' + error.message);
            }
        }

        async function deleteNews(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å?')) {
                try {
                    await db.collection('news').doc(id).delete();
                    alert('‚úÖ –ù–æ–≤–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞!');
                    loadNews();
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
                }
            }
        }

        function resetNewsForm() {
            document.getElementById('news-form').reset();
            document.getElementById('news-id').value = '';
            document.getElementById('news-date').value = new Date().toISOString().slice(0, 16);
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('news-date').value = new Date().toISOString().slice(0, 16);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        db.collection('games').limit(1).get().then(() => {
            console.log('‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω');
        }).catch((error) => {
            console.error('‚ùå –û—à–∏–±–∫–∞ Firebase:', error);
            alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase: ' + error.message);
        });
    </script>
</body>
</html>
