<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Hamster Verse</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .admin-container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        .admin-tab { padding: 10px 20px; background: var(--bg-secondary); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .admin-tab.active { background: var(--accent-gradient); color: white; }
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary); }
        .form-control { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-family: inherit; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
        .btn-primary { background: var(--accent-gradient); color: white; }
        .btn-danger { background: #ff4444; color: white; }
        .items-list { display: grid; gap: 15px; margin-top: 20px; }
        .item-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .item-actions { display: flex; gap: 10px; }
        .game-preview { display: flex; align-items: center; gap: 15px; }
        .game-preview img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }
        
        .sync-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: var(--shadow-hover);
            z-index: 10000;
            max-width: 320px;
            animation: notificationSlideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid;
        }
        .sync-notification.success { border-left-color: var(--positive-color); }
        .sync-notification.info { border-left-color: #667eea; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="header-titles">
                    <h1 class="app-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                    <span class="app-subtitle">Hamster Verse - Supabase</span>
                </div>
                <button class="guide-button" onclick="window.location.href='index.html'">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
                </button>
            </div>
        </header>

        <main class="main-content">
            <div class="admin-container">
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
                    <button class="admin-tab" data-tab="price">üí∞ –ö—É—Ä—Å HMSTR</button>
                    <button class="admin-tab" data-tab="news">üì∞ –ù–æ–≤–æ—Å—Ç–∏</button>
                </div>

                <!-- Games Section -->
                <div id="games-section" class="admin-section active">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏</h2>
                    <form id="game-form">
                        <input type="hidden" id="game-id">
                        <div class="form-group">
                            <label for="game-name">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã</label>
                            <input type="text" id="game-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="game-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea id="game-description" class="form-control" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="game-image">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                            <input type="url" id="game-image" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="game-url">–°—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞</label>
                            <input type="url" id="game-url" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="game-players">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</label>
                            <input type="text" id="game-players" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="game-beta"> –ë–µ—Ç–∞-–≤–µ—Ä—Å–∏—è</label>
                        </div>
                        <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Supabase</button>
                    </form>

                    <div class="items-list" id="games-list"></div>
                </div>

                <!-- Price Section -->
                <div id="price-section" class="admin-section">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–º HMSTR</h2>
                    <form id="price-form">
                        <div class="form-group">
                            <label for="hmstr-price">–¶–µ–Ω–∞ HMSTR (USD)</label>
                            <input type="number" id="hmstr-price" class="form-control" step="0.000001" required>
                        </div>
                        <div class="form-group">
                            <label for="hmstr-change">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ 24—á (%)</label>
                            <input type="number" id="hmstr-change" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="hmstr-marketcap">–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è (–≤ –º–∏–ª–ª–∏–æ–Ω–∞—Ö)</label>
                            <input type="number" id="hmstr-marketcap" class="form-control" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="hmstr-volume">–û–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤ 24—á (–≤ –º–∏–ª–ª–∏–æ–Ω–∞—Ö)</label>
                            <input type="number" id="hmstr-volume" class="form-control" step="0.1" required>
                        </div>
                        <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Supabase</button>
                    </form>
                </div>

                <!-- News Section -->
                <div id="news-section" class="admin-section">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</h2>
                    <form id="news-form">
                        <input type="hidden" id="news-id">
                        <div class="form-group">
                            <label for="news-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <input type="text" id="news-title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="news-content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                            <textarea id="news-content" class="form-control" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="news-image">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                            <input type="url" id="news-image" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="news-date">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                            <input type="datetime-local" id="news-date" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Supabase</button>
                    </form>

                    <div class="items-list" id="news-list"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
        const SUPABASE_CONFIG = {
            url: 'https://hubgtmchajwzerldgtjh.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1Ymd0bWNoYWp3emVybGRndGpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2NDMyNjAsImV4cCI6MjA3NjIxOTI2MH0.bHMgD-GMSwAwd7tO_I1v_aHC82yYrWQgEySRAoHbJ5o'
        };

        const supabase = supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);

        if (localStorage.getItem('is_admin') !== 'true') {
            alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
            window.location.href = 'index.html';
        }

        document.querySelectorAll('.admin-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(`${targetTab}-section`).classList.add('active');
            });
        });

        loadGames();
        loadPriceData();
        loadNews();

        function showSyncNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `sync-notification ${type}`;
            
            notification.innerHTML = `
                <div class="notification-icon">${type === 'success' ? '‚úÖ' : 'üîÑ'}</div>
                <div class="notification-content">
                    <div class="notification-title">${type === 'success' ? '–£—Å–ø–µ—à–Ω–æ' : '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è'}</div>
                    <div class="notification-message">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('slide-out');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        document.getElementById('game-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await saveGame();
        });

        async function loadGames() {
            try {
                const { data: games, error } = await supabase
                    .from('games')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                displayGamesList(games || []);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä:', error);
                document.getElementById('games-list').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        }

        async function saveGame() {
            const gameData = {
                name: document.getElementById('game-name').value,
                description: document.getElementById('game-description').value,
                image_url: document.getElementById('game-image').value,
                game_url: document.getElementById('game-url').value,
                players_count: document.getElementById('game-players').value,
                is_beta: document.getElementById('game-beta').checked,
                created_at: new Date().toISOString()
            };

            const gameId = document.getElementById('game-id').value;

            try {
                showSyncNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏...', 'info');
                
                let result;
                if (gameId) {
                    result = await supabase
                        .from('games')
                        .update(gameData)
                        .eq('id', gameId);
                } else {
                    result = await supabase
                        .from('games')
                        .insert([gameData]);
                }

                if (result.error) throw result.error;
                
                showSyncNotification('‚úÖ –ò–≥—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ', 'success');
                resetGameForm();
                loadGames();
                
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        function displayGamesList(games) {
            const container = document.getElementById('games-list');
            container.innerHTML = games.map(game => `
                <div class="item-card">
                    <div class="game-preview">
                        <img src="${game.image_url}" alt="${game.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzY2N2VlYSIvPgo8L3N2Zz4K'">
                        <div>
                            <strong>${game.name}</strong>
                            <div style="font-size: 12px; color: var(--text-secondary);">${game.players_count} –∏–≥—Ä–æ–∫–æ–≤</div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn" onclick="editGame('${game.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteGame('${game.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function editGame(id) {
            try {
                const { data: game, error } = await supabase
                    .from('games')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error) throw error;

                if (game) {
                    document.getElementById('game-id').value = id;
                    document.getElementById('game-name').value = game.name;
                    document.getElementById('game-description').value = game.description;
                    document.getElementById('game-image').value = game.image_url;
                    document.getElementById('game-url').value = game.game_url;
                    document.getElementById('game-players').value = game.players_count;
                    document.getElementById('game-beta').checked = game.is_beta || false;
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã: ' + error.message);
            }
        }

        async function deleteGame(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∏–≥—Ä—É?')) {
                try {
                    const { error } = await supabase
                        .from('games')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                    
                    showSyncNotification('‚úÖ –ò–≥—Ä–∞ —É–¥–∞–ª–µ–Ω–∞!', 'success');
                    loadGames();
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
                }
            }
        }

        function resetGameForm() {
            document.getElementById('game-form').reset();
            document.getElementById('game-id').value = '';
        }

        document.getElementById('price-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await savePriceData();
        });

        async function loadPriceData() {
            try {
                const { data: price, error } = await supabase
                    .from('settings')
                    .select('*')
                    .eq('id', 'price')
                    .single();

                if (error) throw error;
                
                if (price) {
                    document.getElementById('hmstr-price').value = price.hmstr_price;
                    document.getElementById('hmstr-change').value = price.price_change;
                    document.getElementById('hmstr-marketcap').value = price.market_cap;
                    document.getElementById('hmstr-volume').value = price.volume_24h;
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–∞:', error);
            }
        }

        async function savePriceData() {
            const priceData = {
                hmstr_price: parseFloat(document.getElementById('hmstr-price').value),
                price_change: parseFloat(document.getElementById('hmstr-change').value),
                market_cap: document.getElementById('hmstr-marketcap').value,
                volume_24h: document.getElementById('hmstr-volume').value,
                updated_at: new Date().toISOString()
            };

            try {
                showSyncNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫—É—Ä—Å–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏...', 'info');
                
                const { error } = await supabase
                    .from('settings')
                    .update(priceData)
                    .eq('id', 'price');

                if (error) throw error;
                
                showSyncNotification('‚úÖ –ö—É—Ä—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ', 'success');
                
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        document.getElementById('news-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await saveNews();
        });

        async function loadNews() {
            try {
                const { data: news, error } = await supabase
                    .from('news')
                    .select('*')
                    .order('publish_date', { ascending: false });

                if (error) throw error;
                displayNewsList(news || []);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π:', error);
            }
        }

        async function saveNews() {
            const newsData = {
                title: document.getElementById('news-title').value,
                content: document.getElementById('news-content').value,
                image_url: document.getElementById('news-image').value,
                publish_date: document.getElementById('news-date').value,
                is_published: true
            };

            const newsId = document.getElementById('news-id').value;

            try {
                showSyncNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏...', 'info');
                
                let result;
                if (newsId) {
                    result = await supabase
                        .from('news')
                        .update(newsData)
                        .eq('id', newsId);
                } else {
                    result = await supabase
                        .from('news')
                        .insert([newsData]);
                }

                if (result.error) throw result.error;
                
                showSyncNotification('‚úÖ –ù–æ–≤–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ', 'success');
                resetNewsForm();
                loadNews();
                
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        function displayNewsList(news) {
            const container = document.getElementById('news-list');
            container.innerHTML = news.map(item => `
                <div class="item-card">
                    <div>
                        <strong>${item.title}</strong>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${new Date(item.publish_date).toLocaleDateString('ru-RU')}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn" onclick="editNews('${item.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteNews('${item.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function editNews(id) {
            try {
                const { data: news, error } = await supabase
                    .from('news')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error) throw error;

                if (news) {
                    document.getElementById('news-id').value = id;
                    document.getElementById('news-title').value = news.title;
                    document.getElementById('news-content').value = news.content;
                    document.getElementById('news-image').value = news.image_url || '';
                    document.getElementById('news-date').value = news.publish_date.slice(0, 16);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–∏: ' + error.message);
            }
        }

        async function deleteNews(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å?')) {
                try {
                    const { error } = await supabase
                        .from('news')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                    
                    showSyncNotification('‚úÖ –ù–æ–≤–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞!', 'success');
                    loadNews();
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
                }
            }
        }

        function resetNewsForm() {
            document.getElementById('news-form').reset();
            document.getElementById('news-id').value = '';
            document.getElementById('news-date').value = new Date().toISOString().slice(0, 16);
        }

        document.getElementById('news-date').value = new Date().toISOString().slice(0, 16);

        supabase.from('games').select('*').limit(1).then((result) => {
            if (!result.error) {
                console.log('‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω');
            } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ Supabase:', result.error);
            }
        });
    </script>
</body>
</html>
